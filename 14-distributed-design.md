# 14. 分布式与系统设计

## 知识点详解

### 14.1 CAP与一致性模型
CAP指出在分区容忍条件下只能在一致性与可用性之间取舍。强一致适合金融、订单等关键业务，最终一致适合高可用与高吞吐场景。实际系统常在不同业务路径采用不同一致性策略。

### 14.2 分布式锁
Redis锁实现简单、性能高，但需要处理过期续约、主从切换与误删问题；Zookeeper锁基于临时顺序节点，天然具备会话语义和公平性，代价是性能与运维复杂度更高。锁设计应包含唯一标识与过期控制。

### 14.3 分布式ID
雪花算法具备趋势递增与高性能，但要处理时钟回拨；号段模式依赖数据库或配置中心发号，适合高可用但实现复杂。UUID简单但无序且存储占用高。

### 14.4 限流、熔断、降级
限流保护系统入口，熔断在依赖故障时快速失败并避免雪崩，降级提供核心能力保底。三者结合可以提升整体系统韧性。

## 面试点与参考回答

### Q1 如何设计分布式锁避免死锁
为锁设置过期时间，使用唯一标识防止误删，续约需保证只有持有者续约。业务层面应避免锁嵌套并控制锁粒度，必要时引入锁顺序或超时策略。

### Q2 限流常见算法及实现
固定窗口实现简单但有突刺问题；滑动窗口精度高但成本高；令牌桶支持突发流量；漏桶更平滑。分布式限流可用Redis计数或令牌桶脚本保证原子性。

## 掌握评估

### 自测1 能设计一个高并发系统的核心组件
给定QPS目标与SLA，设计缓存、限流、异步化与数据库分片等核心组件，并说明瓶颈与扩展方式。

### 自测2 能解释一致性与可用性取舍
结合具体业务场景说明为什么选择强一致或最终一致，以及失败时的降级策略。
