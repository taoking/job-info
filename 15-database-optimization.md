# 15. 数据库与性能优化

## 知识点详解

### 15.1 索引
B+Tree索引适合范围查询和排序；覆盖索引可避免回表；索引失效常因函数操作、隐式类型转换、前导通配符、条件不满足最左前缀等。索引设计应以高选择性与查询模式为基础。

### 15.2 SQL优化
优化流程包括开启慢查询日志、使用EXPLAIN分析执行计划、检查索引使用情况与统计信息。常见优化手段有：减少返回列、避免大偏移分页、合理拆分复杂SQL。

### 15.3 事务隔离
隔离级别从低到高为读未提交、读已提交、可重复读、串行化。隔离级别越高，一致性越强但并发性能下降。MySQL的MVCC在RC和RR下可减少锁冲突，但仍需注意幻读与锁范围。

## 面试点与参考回答

### Q1 MySQL索引失效场景
常见场景包括在索引列上使用函数或表达式、类型不匹配导致隐式转换、前导通配符、联合索引未遵循最左前缀、查询条件选择性低或使用OR导致无法走索引。

### Q2 如何分析慢查询
先定位慢SQL，查看执行计划确认是否走索引，再检查索引选择性、回表次数与排序方式，必要时重写SQL或增加合适索引。

## 掌握评估

### 自测1 能写出高效SQL并解释执行计划
以分页或聚合为例，给出优化后的SQL，并说明执行计划中的关键字段含义，如type、rows、extra。

### 自测2 能描述隔离级别与锁的关系
说明不同隔离级别下锁范围的变化，以及在高并发场景下如何权衡一致性与性能。
