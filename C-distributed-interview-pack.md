# C. 分布式与系统设计面试题示例与参考答案

## 面试题示例与参考答案

### Q1 CAP如何影响系统设计
CAP说明在分区容忍前提下只能在一致性与可用性之间取舍。关键是根据业务场景选择一致性模型，例如支付选择强一致、日志或统计选择最终一致。

### Q2 分布式锁的实现方式与风险点
Redis锁简单高效但需处理过期续约、主从切换和误删；Zookeeper锁公平且可靠，但性能和运维成本更高。风险点包括锁续期失败、误删与锁竞争导致的性能下降。

### Q3 如何设计一个全局唯一ID
常见方案有雪花算法、号段模式、数据库自增和UUID。选择时需考虑时钟回拨、趋势递增、分片路由与存储成本。

### Q4 缓存一致性有哪些常用方案
Cache-Aside是最常见方案，写先更新DB再删缓存。为降低并发读写问题可使用延迟双删或订阅binlog刷新。对强一致需求可考虑写穿或写回。

### Q5 如何保证消息队列不丢不重
采用“至少一次投递 + 幂等消费”是现实方案。通过唯一业务键、去重表、事务消息或Outbox模式保证一致性与可重试性。

### Q6 限流常见算法有哪些？适用场景
固定窗口简单但突刺明显；滑动窗口精度高但开销大；令牌桶支持突发流量；漏桶更平滑。选择依据是业务对突发流量的容忍度与实现成本。

### Q7 高并发下如何防止缓存击穿/雪崩
击穿可通过互斥锁或热点预热解决；雪崩可用过期时间随机化、预热与多级缓存；穿透可用布隆过滤器或空值缓存。

### Q8 分布式事务的解决方案与取舍
强一致方案如XA/2PC代价高、可用性差；TCC和Saga通过补偿实现一致性但实现复杂；事务消息与Outbox提供最终一致，适合大多数业务系统。

### Q9 如何设计一个高可用服务架构
采用多实例部署、负载均衡、健康检查、限流与熔断、数据多副本与自动故障转移，结合监控告警与自动化运维保证稳定性。

### Q10 如何进行容量规划与压测
明确目标QPS、延迟与资源预算，基于流量模型设计压测脚本，逐步增加压力并记录系统瓶颈，最终给出容量上限与扩容策略。

## 标准答题模板解读

### 步骤1 目标与约束
先说明业务目标、QPS、延迟与可用性要求。

### 步骤2 方案选型
对比可选方案并明确取舍依据。

### 步骤3 关键机制
强调一致性、幂等、容错与降级策略。

### 步骤4 风险与边界
说明异常场景与系统极限，并给出风险控制方式。

### 步骤5 监控与演练
描述指标、告警与演练方案，体现运维与持续改进能力。

## 自测评分表解读

### 设计思路
1分无清晰目标；3分能说明核心目标；5分有约束与权衡。

### 方案取舍
1分只会单方案；3分能对比方案；5分能量化取舍。

### 一致性理解
1分只会背CAP；3分能说明场景；5分能设计策略。

### 可用性策略
1分无降级思路；3分有降级概念；5分有完整容错链。

### 实战表达
1分空泛；3分有案例；5分有指标与效果。

## 资深级参考答案要点与追问

### 1) CAP与一致性
要点是分区容忍不可避免，需要在C与A之间取舍。追问常是强一致与最终一致的业务选择标准。

### 2) 分布式锁
要点是Redis与ZK的取舍、续期与误删防护。追问常是如何证明锁不会误删。

### 3) 全局唯一ID
要点是雪花、号段、UUID与数据库自增的取舍，关注时钟回拨与有序性。追问是时钟回拨处理方式。

### 4) 缓存一致性
要点是Cache-Aside、双删、binlog订阅与穿透/击穿/雪崩防护。追问是如何避免脏读与并发覆盖。

### 5) 消息不丢不重
要点是至少一次投递与幂等消费、事务消息或Outbox模式。追问是幂等设计与事务的结合方式。

### 6) 限流算法
要点是令牌桶、漏桶、滑动窗口与固定窗口的适用场景。追问是分布式限流的一致性保证方式。

### 7) 分布式事务
要点是XA/2PC、TCC、Saga与最终一致方案的取舍。追问是如何选择TCC与Saga。

## 资深级自测标准

### 标准1
能给出“业务目标 -> 架构选择 -> 风险点”的完整回答。

### 标准2
能量化容量规划，并说明压测方法。

### 标准3
能描述故障演练与降级预案。
