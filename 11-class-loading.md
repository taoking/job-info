# 11. 类加载机制

## 知识点详解

### 11.1 双亲委派模型
双亲委派保证核心类只被加载一次并防止篡改，提升安全性和一致性。类加载请求会先委派给父加载器，只有父加载器无法加载时才由子加载器尝试。

### 11.2 自定义类加载器
自定义类加载器可实现隔离与热加载，例如插件机制或容器隔离。通过不同类加载器加载相同类名的类，会在JVM中形成不同的“类型”，可能导致ClassCastException。

### 11.3 破坏双亲委派的典型场景
SPI机制使用线程上下文类加载器使得父加载器可以“反向”加载子类路径中的实现。应用服务器与容器也常打破双亲委派以支持多版本类库共存。

## 面试点与参考回答

### Q1 为什么需要双亲委派
双亲委派保证JDK核心类库优先加载，防止用户自定义类冒充核心类，同时避免同一个类被重复加载。

### Q2 SPI机制如何实现
SPI通过线程上下文类加载器让父加载器加载位于应用类路径下的实现类，实现“上层接口、下层实现”的解耦。

## 掌握评估

### 自测1 能描述类加载流程与阶段
说明加载、链接（验证、准备、解析）与初始化阶段的主要动作，并能结合类加载时机解释静态初始化顺序。

### 自测2 能解释不同类加载器导致的ClassCast异常
用示例说明同名类由不同类加载器加载后视为不同类型，导致强制类型转换失败，并给出排查方法。
