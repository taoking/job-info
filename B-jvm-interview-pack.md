# B. JVM面试题示例与参考答案

## 面试题示例与参考答案

### Q1 JVM内存结构有哪些区域？各自存放什么
堆存放对象实例；栈保存线程栈帧与局部变量；方法区（Metaspace）存放类元数据与运行时常量；直接内存用于NIO缓冲区。不同区域的溢出提示不同，诊断方法也不同。

### Q2 解释Young GC与Full GC的触发条件
Young GC通常由Eden区耗尽触发，回收年轻代；Full GC常由老年代或元空间不足、显式System.gc或担保失败触发。频繁Full GC通常意味着晋升过快或老年代回收效率不足。

### Q3 CMS与G1的区别与适用场景
CMS以低停顿为目标，但会产生碎片并可能触发Full GC；G1按Region管理并预测停顿时间，适合大堆与低延迟场景。CMS更适合中等规模堆且能容忍碎片管理成本的场景。

### Q4 ZGC的核心目标是什么
ZGC追求极低停顿，通过并发标记与转移降低停顿时间，适合超大堆和对延迟敏感的系统，但对CPU资源与版本支持有一定要求。

### Q5 OOM的常见类型与排查步骤
常见类型包括Java heap space、Metaspace、GC overhead limit exceeded、Direct buffer memory、unable to create new native thread。排查通常通过heap dump、GC日志与系统资源监控定位对象占用和分配趋势。

### Q6 如何判断GC是否成为性能瓶颈
关注停顿时间、GC频率、吞吐比例，结合延迟分位数与CPU使用率。如果GC停顿占比高且伴随吞吐下降，则需要调整参数或优化分配。

### Q7 类加载流程与双亲委派模型作用
类加载包括加载、链接（验证、准备、解析）和初始化。双亲委派保证核心类优先加载，避免类被篡改并确保一致性。

### Q8 如何定位内存泄漏
通过heap dump分析对象占用与引用链，找出“本应释放却被引用”的对象集合，结合业务逻辑定位持有引用的根因。

### Q9 解释逃逸分析与标量替换
逃逸分析判断对象是否被线程外部访问，若不逃逸可进行标量替换或栈上分配，从而减少堆分配和GC压力。实际优化取决于JIT与运行条件。

### Q10 线上CPU飙高但GC正常，怎么排查
先定位高CPU线程并获取线程栈，确认热点方法；如果线程均为RUNNABLE，考虑死循环或热点计算；必要时用采样或火焰图分析。

## 标准答题模板解读

### 步骤1 现象或问题
先说明可观测现象，例如“Full GC频繁导致停顿”。

### 步骤2 结构或机制
解释JVM内部机制，如年轻代/老年代结构或GC算法。

### 步骤3 触发条件
说明哪些配置或行为会触发问题。

### 步骤4 影响与权衡
分析对吞吐、延迟和内存的影响，并指出权衡点。

### 步骤5 解决方案
给出可操作方案，包括参数调整、代码优化和工具定位。

## 自测评分表解读

### 结构理解
1分只会背名词；3分能说出区域作用；5分能结合具体问题定位。

### GC理解
1分分不清GC类型；3分能说明差异；5分能进行合理选型与参数建议。

### 工具能力
1分不会用工具；3分会用单个工具；5分能组合工具形成诊断链路。

### 参数与优化
1分只会套参数；3分能解释参数作用；5分能针对场景调优并验证效果。

### 诊断思路
1分无排查路径；3分有初步路径；5分有完整排障链路并能复现。

## 资深级参考答案要点与追问

### 1) JVM内存结构
要点是堆、栈、方法区、直接内存的职责，补充常量池与Metaspace。追问常在PermGen与Metaspace差异。

### 2) Young GC与Full GC触发
要点是Eden耗尽触发YGC，老年代/元空间不足触发FGC，并关注晋升失败。追问是如何从日志看晋升失败。

### 3) CMS与G1
要点是CMS低停顿但碎片多，G1可预测停顿、Region化管理。追问是G1对Humongous对象的处理。

### 4) ZGC目标
要点是极低停顿与并发回收，适合大堆。追问是其代价与适用边界。

### 5) OOM类型与排查
要点是常见OOM类型及heap dump、jmap、GC日志的组合排查。追问是如何区分内存泄漏与内存浪费。

### 6) GC是否成为瓶颈
要点是停顿时间、频率与吞吐占比，结合分配速率。追问是如何判断分配过快还是晋升过快。

### 7) 类加载与双亲委派
要点是安全与唯一性，自定义加载器用于隔离。追问是同名类导致ClassCast异常的原因。

### 8) 逃逸分析与标量替换
要点是对象不逃逸可被标量替换或栈上分配，减少GC。追问是哪些代码模式导致逃逸。

### 9) CPU飙高但GC正常
要点是定位高CPU线程并分析栈或火焰图。追问是RUNNABLE线程的进一步排查策略。

## 资深级自测标准

### 标准1
能读懂一段GC日志并解释吞吐与停顿变化。

### 标准2
能给出“调参与代码优化”的取舍理由并说明验证方式。

### 标准3
能在不重启的前提下完成线上诊断。
