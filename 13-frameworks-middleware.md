# 13. 框架与中间件基础

## 知识点详解

### 13.1 Spring核心
IoC负责对象的创建与生命周期管理，降低组件耦合；AOP通过代理实现横切逻辑如日志、监控与事务；事务管理提供声明式事务、传播行为与隔离级别控制。理解其“容器 + 代理”的核心思想是面试与排障的基础。

### 13.2 MyBatis/JPA
MyBatis更贴近SQL，适合复杂查询与性能优化；JPA强调对象模型与ORM映射。常见性能问题包括N+1查询、分页不当、二级缓存使用不当。分页需结合索引与统计信息，避免大偏移导致的慢查询。

### 13.3 Redis
Redis支持字符串、哈希、列表、集合、有序集合等结构，适合缓存、计数、排行榜与分布式锁。缓存一致性常用Cache-Aside模式，需处理穿透、击穿和雪崩等问题，可通过布隆过滤器、互斥锁、过期随机化等手段缓解。

### 13.4 消息队列
Kafka与RabbitMQ在吞吐和功能上取舍不同。可靠性依赖生产者确认、Broker持久化、消费者幂等与重试。实际系统中“至少一次投递 + 幂等消费”是主流方案。

## 面试点与参考回答

### Q1 缓存一致性的解决方案
常见方案是Cache-Aside：写先更新数据库再删除缓存；读缓存未命中则回源并写回。为降低并发读写冲突，可使用延迟双删或订阅binlog进行缓存刷新。对于高一致性需求，可采用写穿或写回策略，但成本更高。

### Q2 消息重复消费如何处理
通过幂等设计解决，例如使用业务唯一键去重、消费端维护去重表、或在数据库层做幂等更新。对于有事务需求的系统，可用Outbox或事务消息保证一致性。

## 掌握评估

### 自测1 能描述常见中间件的核心能力与边界
给出每个中间件适用场景、不可替代能力与边界限制，例如Redis不适合作为强一致存储，消息队列不保证严格有序。

### 自测2 能给出合理的防护策略
针对缓存穿透、击穿、雪崩，以及消息重复与丢失，列出可落地的技术措施并说明取舍。
